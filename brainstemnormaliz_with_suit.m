% AUTHOR        Veronica Maki-Marttunen
% CONTACT       makimarttunen.veronica@gmail.com
% DATE          August 2020
% MATLAB        R2019b
% Code shared with publication Uncovering the locus coeruleus
% 2020

% Example code to perform brainstem and cerebellum-specific normalization of EPI images
% For full explanation of the normalization steps please read carefully the manual of
% SPM toolbox SUIT: http://www.diedrichsenlab.org/imaging/suit.htm
% Version used here: SUIT 3.3 (Diedrichsen, 2006)

% Isolate brainstem and cerebellum of individual's T1s
D=dir; % directory should contain subject's folders
for s=3:length(D)
    suit_isolate([D(s).name,'\rcT1.nii']); % path to T1 images coregistered to EPI
end

% Check isolated cerebellum and brainstem before normalization!

% The next steps calculate the transformation fields and apply to the images in
% the variable called source

for s=3:length(D)
    suit_normalize([D(s).name,'\c_rcT1.nii'],'mask', [D(s).name,'\c_rcT1_pcereb_corr.nii']);
    source={[D(s).name,'\brainstem_cropped.nii']
        [D(s).name,'\rcT1.nii']
        [D(s).name,'\arbold.nii,1']
        [D(s).name,'\arbold.nii,2']
        [D(s).name,'\arbold.nii,3']
        [D(s).name,'\arbold.nii,4']
        [D(s).name,'\arbold.nii,5']
        [D(s).name,'\arbold.nii,6']
        [D(s).name,'\arbold.nii,7']
        [D(s).name,'\arbold.nii,8']
        [D(s).name,'\arbold.nii,9']
        [D(s).name,'\arbold.nii,10']
        [D(s).name,'\arbold.nii,11']
        [D(s).name,'\arbold.nii,12']
        [D(s).name,'\arbold.nii,13']
        [D(s).name,'\arbold.nii,14']
        [D(s).name,'\arbold.nii,15']
        [D(s).name,'\arbold.nii,16']
        [D(s).name,'\arbold.nii,17']
        [D(s).name,'\arbold.nii,18']
        [D(s).name,'\arbold.nii,19']
        [D(s).name,'\arbold.nii,20']
        [D(s).name,'\arbold.nii,21']
        [D(s).name,'\arbold.nii,22']
        [D(s).name,'\arbold.nii,23']
        [D(s).name,'\arbold.nii,24']
        [D(s).name,'\arbold.nii,25']
        [D(s).name,'\arbold.nii,26']
        [D(s).name,'\arbold.nii,27']
        [D(s).name,'\arbold.nii,28']
        [D(s).name,'\arbold.nii,29']
        [D(s).name,'\arbold.nii,30']
        [D(s).name,'\arbold.nii,31']
        [D(s).name,'\arbold.nii,32']
        [D(s).name,'\arbold.nii,33']
        [D(s).name,'\arbold.nii,34']
        [D(s).name,'\arbold.nii,35']
        [D(s).name,'\arbold.nii,36']
        [D(s).name,'\arbold.nii,37']
        [D(s).name,'\arbold.nii,38']
        [D(s).name,'\arbold.nii,39']
        [D(s).name,'\arbold.nii,40']
        [D(s).name,'\arbold.nii,41']
        [D(s).name,'\arbold.nii,42']
        [D(s).name,'\arbold.nii,43']
        [D(s).name,'\arbold.nii,44']
        [D(s).name,'\arbold.nii,45']
        [D(s).name,'\arbold.nii,46']
        [D(s).name,'\arbold.nii,47']
        [D(s).name,'\arbold.nii,48']
        [D(s).name,'\arbold.nii,49']
        [D(s).name,'\arbold.nii,50']
        [D(s).name,'\arbold.nii,51']
        [D(s).name,'\arbold.nii,52']
        [D(s).name,'\arbold.nii,53']
        [D(s).name,'\arbold.nii,54']
        [D(s).name,'\arbold.nii,55']
        [D(s).name,'\arbold.nii,56']
        [D(s).name,'\arbold.nii,57']
        [D(s).name,'\arbold.nii,58']
        [D(s).name,'\arbold.nii,59']
        [D(s).name,'\arbold.nii,60']
        [D(s).name,'\arbold.nii,61']
        [D(s).name,'\arbold.nii,62']
        [D(s).name,'\arbold.nii,63']
        [D(s).name,'\arbold.nii,64']
        [D(s).name,'\arbold.nii,65']
        [D(s).name,'\arbold.nii,66']
        [D(s).name,'\arbold.nii,67']
        [D(s).name,'\arbold.nii,68']
        [D(s).name,'\arbold.nii,69']
        [D(s).name,'\arbold.nii,70']
        [D(s).name,'\arbold.nii,71']
        [D(s).name,'\arbold.nii,72']
        [D(s).name,'\arbold.nii,73']
        [D(s).name,'\arbold.nii,74']
        [D(s).name,'\arbold.nii,75']
        [D(s).name,'\arbold.nii,76']
        [D(s).name,'\arbold.nii,77']
        [D(s).name,'\arbold.nii,78']
        [D(s).name,'\arbold.nii,79']
        [D(s).name,'\arbold.nii,80']
        [D(s).name,'\arbold.nii,81']
        [D(s).name,'\arbold.nii,82']
        [D(s).name,'\arbold.nii,83']
        [D(s).name,'\arbold.nii,84']
        [D(s).name,'\arbold.nii,85']
        [D(s).name,'\arbold.nii,86']
        [D(s).name,'\arbold.nii,87']
        [D(s).name,'\arbold.nii,88']
        [D(s).name,'\arbold.nii,89']
        [D(s).name,'\arbold.nii,90']
        [D(s).name,'\arbold.nii,91']
        [D(s).name,'\arbold.nii,92']
        [D(s).name,'\arbold.nii,93']
        [D(s).name,'\arbold.nii,94']
        [D(s).name,'\arbold.nii,95']
        [D(s).name,'\arbold.nii,96']
        [D(s).name,'\arbold.nii,97']
        [D(s).name,'\arbold.nii,98']
        [D(s).name,'\arbold.nii,99']
        [D(s).name,'\arbold.nii,100']
        [D(s).name,'\arbold.nii,101']
        [D(s).name,'\arbold.nii,102']
        [D(s).name,'\arbold.nii,103']
        [D(s).name,'\arbold.nii,104']
        [D(s).name,'\arbold.nii,105']
        [D(s).name,'\arbold.nii,106']
        [D(s).name,'\arbold.nii,107']
        [D(s).name,'\arbold.nii,108']
        [D(s).name,'\arbold.nii,109']
        [D(s).name,'\arbold.nii,110']
        [D(s).name,'\arbold.nii,111']
        [D(s).name,'\arbold.nii,112']
        [D(s).name,'\arbold.nii,113']
        [D(s).name,'\arbold.nii,114']
        [D(s).name,'\arbold.nii,115']
        [D(s).name,'\arbold.nii,116']
        [D(s).name,'\arbold.nii,117']
        [D(s).name,'\arbold.nii,118']
        [D(s).name,'\arbold.nii,119']
        [D(s).name,'\arbold.nii,120']
        [D(s).name,'\arbold.nii,121']
        [D(s).name,'\arbold.nii,122']
        [D(s).name,'\arbold.nii,123']
        [D(s).name,'\arbold.nii,124']
        [D(s).name,'\arbold.nii,125']
        [D(s).name,'\arbold.nii,126']
        [D(s).name,'\arbold.nii,127']
        [D(s).name,'\arbold.nii,128']
        [D(s).name,'\arbold.nii,129']
        [D(s).name,'\arbold.nii,130']
        [D(s).name,'\arbold.nii,131']
        [D(s).name,'\arbold.nii,132']
        [D(s).name,'\arbold.nii,133']
        [D(s).name,'\arbold.nii,134']
        [D(s).name,'\arbold.nii,135']
        [D(s).name,'\arbold.nii,136']
        [D(s).name,'\arbold.nii,137']
        [D(s).name,'\arbold.nii,138']
        [D(s).name,'\arbold.nii,139']
        [D(s).name,'\arbold.nii,140']
        [D(s).name,'\arbold.nii,141']
        [D(s).name,'\arbold.nii,142']
        [D(s).name,'\arbold.nii,143']
        [D(s).name,'\arbold.nii,144']
        [D(s).name,'\arbold.nii,145']
        [D(s).name,'\arbold.nii,146']
        [D(s).name,'\arbold.nii,147']
        [D(s).name,'\arbold.nii,148']
        [D(s).name,'\arbold.nii,149']
        [D(s).name,'\arbold.nii,150']
        [D(s).name,'\arbold.nii,151']
        [D(s).name,'\arbold.nii,152']
        [D(s).name,'\arbold.nii,153']
        [D(s).name,'\arbold.nii,154']
        [D(s).name,'\arbold.nii,155']
        [D(s).name,'\arbold.nii,156']
        [D(s).name,'\arbold.nii,157']
        [D(s).name,'\arbold.nii,158']
        [D(s).name,'\arbold.nii,159']
        [D(s).name,'\arbold.nii,160']
        [D(s).name,'\arbold.nii,161']
        [D(s).name,'\arbold.nii,162']
        [D(s).name,'\arbold.nii,163']
        [D(s).name,'\arbold.nii,164']
        [D(s).name,'\arbold.nii,165']
        [D(s).name,'\arbold.nii,166']
        [D(s).name,'\arbold.nii,167']
        [D(s).name,'\arbold.nii,168']
        [D(s).name,'\arbold.nii,169']
        [D(s).name,'\arbold.nii,170']
        [D(s).name,'\arbold.nii,171']
        [D(s).name,'\arbold.nii,172']
        [D(s).name,'\arbold.nii,173']
        [D(s).name,'\arbold.nii,174']
        [D(s).name,'\arbold.nii,175']
        [D(s).name,'\arbold.nii,176']
        [D(s).name,'\arbold.nii,177']
        [D(s).name,'\arbold.nii,178']
        [D(s).name,'\arbold.nii,179']
        [D(s).name,'\arbold.nii,180']
        [D(s).name,'\arbold.nii,181']
        [D(s).name,'\arbold.nii,182']
        [D(s).name,'\arbold.nii,183']
        [D(s).name,'\arbold.nii,184']
        [D(s).name,'\arbold.nii,185']
        [D(s).name,'\arbold.nii,186']
        [D(s).name,'\arbold.nii,187']
        [D(s).name,'\arbold.nii,188']
        [D(s).name,'\arbold.nii,189']
        [D(s).name,'\arbold.nii,190']
        [D(s).name,'\arbold.nii,191']
        [D(s).name,'\arbold.nii,192']
        [D(s).name,'\arbold.nii,193']
        [D(s).name,'\arbold.nii,194']
        [D(s).name,'\arbold.nii,195']
        [D(s).name,'\arbold.nii,196']
        [D(s).name,'\arbold.nii,197']
        [D(s).name,'\arbold.nii,198']
        [D(s).name,'\arbold.nii,199']
        [D(s).name,'\arbold.nii,200']
        [D(s).name,'\arbold.nii,201']
        [D(s).name,'\arbold.nii,202']
        [D(s).name,'\arbold.nii,203']
        [D(s).name,'\arbold.nii,204']
        [D(s).name,'\arbold.nii,205']
        [D(s).name,'\arbold.nii,206']
        [D(s).name,'\arbold.nii,207']
        [D(s).name,'\arbold.nii,208']
        [D(s).name,'\arbold.nii,209']
        [D(s).name,'\arbold.nii,210']
        [D(s).name,'\arbold.nii,211']
        [D(s).name,'\arbold.nii,212']
        [D(s).name,'\arbold.nii,213']
        [D(s).name,'\arbold.nii,214']
        [D(s).name,'\arbold.nii,215']
        [D(s).name,'\arbold.nii,216']
        [D(s).name,'\arbold.nii,217']
        [D(s).name,'\arbold.nii,218']
        [D(s).name,'\arbold.nii,219']
        [D(s).name,'\arbold.nii,220']
        [D(s).name,'\arbold.nii,221']
        [D(s).name,'\arbold.nii,222']
        [D(s).name,'\arbold.nii,223']
        [D(s).name,'\arbold.nii,224']
        [D(s).name,'\arbold.nii,225']
        [D(s).name,'\arbold.nii,226']
        [D(s).name,'\arbold.nii,227']
        [D(s).name,'\arbold.nii,228']
        [D(s).name,'\arbold.nii,229']
        [D(s).name,'\arbold.nii,230']
        [D(s).name,'\arbold.nii,231']
        [D(s).name,'\arbold.nii,232']
        [D(s).name,'\arbold.nii,233']
        [D(s).name,'\arbold.nii,234']
        [D(s).name,'\arbold.nii,235']
        [D(s).name,'\arbold.nii,236']
        [D(s).name,'\arbold.nii,237']
        [D(s).name,'\arbold.nii,238']
        [D(s).name,'\arbold.nii,239']
        [D(s).name,'\arbold.nii,240']
        [D(s).name,'\arbold.nii,241']
        [D(s).name,'\arbold.nii,242']
        [D(s).name,'\arbold.nii,243']
        [D(s).name,'\arbold.nii,244']
        [D(s).name,'\arbold.nii,245']
        [D(s).name,'\arbold.nii,246']
        [D(s).name,'\arbold.nii,247']
        [D(s).name,'\arbold.nii,248']
        [D(s).name,'\arbold.nii,249']
        [D(s).name,'\arbold.nii,250']
        };
    suit_reslice(source,[D(s).name,'\mc_rcT1_snc.mat'],'mask',[D(s).name,'\c_rcT1_pcereb_corr.nii']);
end

